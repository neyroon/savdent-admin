import{cd as G,j as e,ce as Q,cf as Y,aP as H,n as Z,P as x,B as j,ch as X,aY as _,u as b,r as R,a9 as B,cl as J,cn as K,ep as ee,ci as te,cj as ne,a1 as se,F as w,eq as ae,I,er as E,bN as re,i as D,b4 as W,du as U,es as ie,et as oe,eu as M,d as S,ev as ce,S as T,ew as L,aZ as de,ax as le,bj as ue,T as pe,cv as me,b$ as A}from"./strapi-DI2w5Gri.js";import{F as he}from"./Input-BR5JpzSp-DxXt0cOH.js";import{getDocumentStatus as O}from"./EditViewPage-C6t9zIMh-DB1pNvwy.js";import"./Relations-B6iGFlMU-CFsDCMnF.js";import"./relations-ksVp_JdY-DmF3g5tt.js";import"./usePrev-Bjw2dhmq-BD2ilDoh.js";import"./useDragAndDrop-HYwNDExe-DdRoktix.js";import"./objects-wl73iEma-Di2SK4Bq.js";import"./ComponentIcon-BZcTc4rj-nPePTKo6.js";import"./getEmptyImage-CjqolaH3.js";const ge=()=>{const t=u("PreviewContent",a=>a.url),{formatMessage:s}=b();return e.jsx(j,{src:t,title:s({id:"content-manager.preview.panel.title",defaultMessage:"Preview"}),width:"100%",height:"100%",borderWidth:0,tag:"iframe"},t)},V=()=>{const[{query:t}]=B(),{formatMessage:s}=b(),a=L("BackButton",c=>c.canGoBack),o=L("BackButton",c=>c.goBack),l=L("BackButton",c=>c.history),r=L("BackButton",c=>c.currentLocationIndex),m=a?l.at(r-2):void 0,p={pathname:"..",search:de.stringify(t,{encode:!1})},h=m??p,i=c=>{if(a){c.preventDefault(),o();return}};return e.jsx(I,{variant:"ghost",tag:le,relative:"path",to:h,onClick:i,label:s({id:"content-manager.preview.header.close",defaultMessage:"Close preview"}),children:e.jsx(ue,{})})},$=()=>{const t=u("PreviewHeader",r=>r.document),s=u("PreviewHeader",r=>r.schema),a=u("PreviewHeader",r=>r.meta);if(!(s?.options?.draftAndPublish??!1))return null;const l=O(t,a);return e.jsx(me,{status:l,size:"XS"})},q=()=>{const{formatMessage:t}=b(),[{query:s},a]=B(),o=u("PreviewHeader",i=>i.document),l=u("PreviewHeader",i=>i.schema),r=u("PreviewHeader",i=>i.meta),m=l?.options?.draftAndPublish??!1,p=O(o,r),h=i=>{(i==="published"||i==="draft")&&a({status:i},"push",!0)};return m?e.jsx(A.Root,{variant:"simple",value:s.status||"draft",onValueChange:h,children:e.jsxs(A.List,{"aria-label":t({id:"preview.tabs.label",defaultMessage:"Document status"}),children:[e.jsx(F,{value:"draft",children:t({id:"content-manager.containers.List.draft",defaultMessage:"draft"})}),e.jsx(F,{value:"published",disabled:p==="draft",children:t({id:"content-manager.containers.List.published",defaultMessage:"published"})})]})}):null},fe=()=>{const t=u("PreviewHeader",d=>d.title),s=u("PreviewHeader",d=>d.document),a=u("PreviewHeader",d=>d.schema),o=u("PreviewHeader",d=>d.meta),l=re("PreviewHeader",d=>d.plugins),r=u("PreviewHeader",d=>d.iframeRef),[{query:m}]=B(),{formatMessage:p}=b(),{toggleNotification:h}=D(),{copy:i}=W(),c=()=>{i(window.location.href),h({message:p({id:"content-manager.preview.copy.success",defaultMessage:"Copied preview link"}),type:"success"})},n=a.options?.draftAndPublish??!1,f={activeTab:m.status??null,collectionType:a.kind==="collectionType"?"collection-types":"single-types",model:a.uid,documentId:s.documentId,document:s,meta:o,onPreview:()=>{r?.current?.contentWindow?.postMessage({type:"strapiUpdate"},new URL(r.current.src).origin)}};return e.jsxs(w,{height:"48px",gap:4,background:"neutral0",borderColor:"neutral150",tag:"header",children:[e.jsxs(we,{height:"100%",paddingLeft:2,paddingRight:4,children:[e.jsx(V,{}),e.jsx(N,{tag:"h1",title:t,maxWidth:"200px",fontSize:2,paddingLeft:2,paddingRight:3,fontWeight:600,children:t}),e.jsx($,{})]}),e.jsxs(w,{flex:1,paddingRight:2,gap:2,justifyContent:n?"space-between":"flex-end",children:[e.jsx(w,{flex:"1 1 70%",children:e.jsx(q,{})}),e.jsxs(w,{gap:2,children:[e.jsx(I,{type:"button",label:p({id:"preview.copy.label",defaultMessage:"Copy preview link"}),onClick:c,children:e.jsx(U,{})}),e.jsx(ie,{area:"preview.actions"}),e.jsx(oe,{props:f,descriptions:l["content-manager"].apis.getDocumentActions("preview"),children:d=>{const k=d.filter(y=>[y.position].flat().includes("preview")),[g,v]=k;return!g&&!v?null:g&&v?e.jsxs(e.Fragment,{children:[e.jsx(M,{...v,variant:v.variant||"secondary"}),e.jsx(M,{...g,variant:g.variant||"default"})]}):e.jsx(M,{...g,variant:g.variant||"secondary"})}})]})]})]})},xe=()=>{const t=u("PreviewHeader",r=>r.title),{formatMessage:s}=b(),{toggleNotification:a}=D(),{copy:o}=W(),l=()=>{o(window.location.href),a({message:s({id:"content-manager.preview.copy.success",defaultMessage:"Copied preview link"}),type:"success"})};return e.jsxs(T.Root,{gap:3,gridCols:3,paddingLeft:2,paddingRight:2,background:"neutral0",borderColor:"neutral150",tag:"header",children:[e.jsxs(T.Item,{xs:1,paddingTop:2,paddingBottom:2,gap:3,children:[e.jsx(V,{}),e.jsx(N,{tag:"h1",fontWeight:600,fontSize:2,maxWidth:"200px",title:t,children:t}),e.jsx($,{})]}),e.jsx(T.Item,{xs:1,marginBottom:"-1px",alignItems:"end",margin:"auto",children:e.jsx(q,{})}),e.jsx(T.Item,{xs:1,justifyContent:"end",paddingTop:2,paddingBottom:2,children:e.jsx(I,{type:"button",label:s({id:"preview.copy.label",defaultMessage:"Copy preview link"}),onClick:l,children:e.jsx(U,{})})})]})},N=S(pe)`
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
`,F=S(A.Trigger)`
  text-transform: uppercase;
`,we=S(w)`
  border-right: 1px solid ${({theme:t})=>t.colors.neutral150};
`,[ve,u]=G("PreviewPage"),je=S(ce)`
  will-change: transform;
  rotate: ${t=>t.isSideEditorOpen?"0deg":"180deg"};
  transition: rotate 0.2s ease-in-out;
`,be=()=>{const t=_(),{formatMessage:s}=b(),a=R.useRef(null),[o,l]=R.useState(!0),{slug:r,id:m,collectionType:p}=H(),[{query:h}]=B(),i=R.useMemo(()=>J(h),[h]);if(!p)throw new Error("Could not find collectionType in url params");if(!r)throw new Error("Could not find model in url params");if(p===K&&!m)throw new Error("Could not find documentId in url params");const c=ee({params:{contentType:r},query:{documentId:m,locale:i.locale,status:i.status}}),n=te({model:r,collectionType:p,documentId:m,params:i}),f=ne(r);if((c.isLoading||f.isLoading||n.isLoading)&&!n.document?.documentId)return e.jsx(x.Loading,{});const k=n.getInitialFormValues();if(c.error||f.error||!n.document||!n.meta||!n.schema||!k)return e.jsx(x.Error,{});if(!c.data?.data?.url)return e.jsx(x.NoData,{});const g=n.getTitle(f.edit.settings.mainField),v=(P,C)=>E(n.schema?.attributes,n.components,{status:n.document?.status,...C}).validateSync(P,{abortEarly:!1}),y=c.data.data.url;return e.jsxs(e.Fragment,{children:[e.jsx(x.Title,{children:s({id:"content-manager.preview.page-title",defaultMessage:"{contentType} preview"},{contentType:g})}),e.jsx(ve,{url:y,document:n.document,title:g,meta:n.meta,schema:n.schema,layout:f.edit,iframeRef:a,children:e.jsx(se,{method:"PUT",disabled:h.status==="published"&&n&&n.document.status!=="draft",initialValues:n.getInitialFormValues(),initialErrors:t?.state?.forceValidation?v(k,{}):{},height:"100%",validate:(P,C)=>E(n.schema?.attributes,n.components,{status:n.document?.status,...C}).validate(P,{abortEarly:!1}),children:({resetForm:P})=>e.jsx(w,{direction:"column",height:"100%",alignItems:"stretch",children:window.strapi.future.isEnabled("unstablePreviewSideEditor")?e.jsxs(e.Fragment,{children:[e.jsx(ae,{onProceed:P}),e.jsx(fe,{}),e.jsxs(w,{flex:1,overflow:"auto",alignItems:"stretch",children:[e.jsx(j,{overflow:"auto",width:o?"50%":0,borderWidth:"0 1px 0 0",borderColor:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:o?6:0,paddingRight:o?6:0,transition:"all 0.2s ease-in-out",children:e.jsx(he,{layout:f.edit.layout,hasBackground:!0})}),e.jsxs(j,{position:"relative",flex:1,height:"100%",overflow:"hidden",children:[e.jsx(j,{"data-testid":"preview-iframe",ref:a,src:y,title:s({id:"content-manager.preview.panel.title",defaultMessage:"Preview"}),width:"100%",height:"100%",borderWidth:0,tag:"iframe"},y),e.jsx(I,{variant:"tertiary",label:s(o?{id:"content-manager.preview.content.close-editor",defaultMessage:"Close editor"}:{id:"content-manager.preview.content.open-editor",defaultMessage:"Open editor"}),onClick:()=>l(C=>!C),position:"absolute",top:2,left:2,children:e.jsx(je,{isSideEditorOpen:o})})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{}),e.jsx(ge,{})]})})})})]})},ye=()=>{const{slug:t}=H(),{permissions:s=[],isLoading:a,error:o}=Z([{action:"plugin::content-manager.explorer.read",subject:t},{action:"plugin::content-manager.explorer.update",subject:t},{action:"plugin::content-manager.explorer.publish",subject:t}]);return a?e.jsx(x.Loading,{}):o||!t?e.jsx(j,{height:"100vh",width:"100vw",position:"fixed",top:0,left:0,zIndex:2,background:"neutral0",children:e.jsx(x.Error,{})}):e.jsx(j,{height:"100vh",width:"100vw",position:"fixed",top:0,left:0,zIndex:2,background:"neutral0",children:e.jsx(x.Protect,{permissions:s.filter(l=>l.action.includes("explorer.read")),children:e.jsx(X,{permissions:s,children:e.jsx(be,{})})})})},Ae=()=>e.jsx(Q,{children:e.jsx(Y,{children:e.jsx(ye,{})})});export{Ae as ProtectedPreviewPage,u as usePreviewContext};
