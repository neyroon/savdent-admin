import{aY as z,a9 as O,u as Y,i as q,cp as G,r as Q,cw as k,cj as H,j as s,P as o,aA as U,a1 as _,ex as $,b$ as c,ey as h,S as f,ez as J,eq as K,er as L,aP as W,n as X,cg as Z,ch as ss,d as es,eA as ts}from"./strapi-DI2w5Gri.js";import{a as as,F as P}from"./Input-BR5JpzSp-DxXt0cOH.js";import"./Relations-B6iGFlMU-CFsDCMnF.js";import"./relations-ksVp_JdY-DmF3g5tt.js";import"./usePrev-Bjw2dhmq-BD2ilDoh.js";import"./useDragAndDrop-HYwNDExe-DdRoktix.js";import"./objects-wl73iEma-Di2SK4Bq.js";import"./ComponentIcon-BZcTc4rj-nPePTKo6.js";import"./getEmptyImage-CjqolaH3.js";const is=e=>Q.useEffect(e,ns),ns=[],rs=()=>{const e=z(),[{query:{status:a}},i]=O({status:"draft"}),{formatMessage:n}=Y(),{toggleNotification:r}=q(),{document:x,meta:d,isLoading:T,schema:l,components:j,collectionType:v,id:C,model:A,hasError:D,getTitle:b,getInitialFormValues:I}=G(),u=l?.options?.draftAndPublish??!1;is(()=>{e?.state&&"error"in e.state&&r({type:"danger",message:e.state.error,timeout:5e3})});const R=k("EditViewPage",t=>t.isLoading),m=!C&&!(v===ts),{isLoading:V,edit:{layout:y,settings:{mainField:S}}}=H(A),{isLazyLoading:F}=as([]),M=R||T||V||F,g=I(m);if(M&&!x?.documentId)return s.jsx(o.Loading,{});if(!g||D)return s.jsx(o.Error,{});const B=t=>{(t==="published"||t==="draft")&&i({status:t},"push",!0)},w=(t,p)=>L(l?.attributes,j,{status:a,...p}).validateSync(t,{abortEarly:!1});return s.jsxs(U,{paddingLeft:10,paddingRight:10,children:[s.jsx(o.Title,{children:b(S)}),s.jsx(_,{disabled:u&&a==="published",initialValues:g,method:m?"POST":"PUT",validate:(t,p)=>L(l?.attributes,j,{status:a,...p}).validate(t,{abortEarly:!1}),initialErrors:e?.state?.forceValidation?w(g,{}):{},children:({resetForm:t})=>s.jsxs(s.Fragment,{children:[s.jsx($,{isCreating:m,status:u?os(x,d):void 0,title:b(S)}),s.jsxs(c.Root,{variant:"simple",value:a,onValueChange:B,children:[s.jsx(c.List,{"aria-label":n({id:h("containers.edit.tabs.label"),defaultMessage:"Document status"}),children:u?s.jsxs(s.Fragment,{children:[s.jsx(E,{value:"draft",children:n({id:h("containers.edit.tabs.draft"),defaultMessage:"draft"})}),s.jsx(E,{disabled:!d||d.availableStatus.length===0,value:"published",children:n({id:h("containers.edit.tabs.published"),defaultMessage:"published"})})]}):null}),s.jsxs(f.Root,{paddingTop:8,gap:4,children:[s.jsxs(f.Item,{col:9,s:12,direction:"column",alignItems:"stretch",children:[s.jsx(c.Content,{value:"draft",children:s.jsx(P,{layout:y})}),s.jsx(c.Content,{value:"published",children:s.jsx(P,{layout:y})})]}),s.jsx(f.Item,{col:3,s:12,direction:"column",alignItems:"stretch",children:s.jsx(J,{})})]})]}),s.jsx(K,{onProceed:t})]})})]})},E=es(c.Trigger)`
  text-transform: uppercase;
`,os=(e,a)=>{const i=e?.status,n=a?.availableStatus??[];return i?i==="draft"&&n.find(r=>r.publishedAt!==null)?"published":i:"draft"},js=()=>{const{slug:e=""}=W(),{permissions:a=[],isLoading:i,error:n}=X(Z.map(r=>({action:r,subject:e})));return i?s.jsx(o.Loading,{}):n||!e?s.jsx(o.Error,{}):s.jsx(o.Protect,{permissions:a,children:({permissions:r})=>s.jsx(ss,{permissions:r,children:s.jsx(rs,{})})})};export{rs as EditViewPage,js as ProtectedEditViewPage,os as getDocumentStatus};
